import{k as y,e as f,q as d,l as m,s as j,o as u,w as p,m as w,n as v,U as D,d as N,M as P,a as M,j as e,L as h,u as q,r as C}from"./index-FIlqUQy7.js";import{u as b,a as B}from"./useProductsQuery-7DOrtXK_.js";import{M as I}from"./MyPageLayout-nhL4BXZX.js";import{B as A}from"./index-j0nxY3oc.js";import{D as E,a as Q,b as S,c as x}from"./dropdown-menu-q94PI4Z2.js";import{B as k}from"./button-zmJg5Lpq.js";import L from"./getImageUrl-OqKMeRG-.js";import{p as T}from"./priceToString-jyYOkqXM.js";import F from"./deleteImage-b0kAj98o.js";import{u as V}from"./useMutation-Kl6C4Vrm.js";import{u as K}from"./useQuery-cNdFQeOr.js";import{M as $}from"./MetaTag-VgbHpOZK.js";import"./suspense-eH29BjpB.js";import"./iconBase-iSPQGmgu.js";import"./utils-e7QYg_mL.js";import"./index-JylqWpyc.js";import"./index-gxEFgUwi.js";import"./index-EOJ1QxCX.js";import"./Combination-3J9WhP_G.js";import"./check-MbevbEUm.js";import"./index-yRSaLw9b.js";import"./createLucideIcon-660fMRwt.js";import"./index-ErLbnoe3.js";import"./index-WMLiEZMb.js";import"./chevron-right-p5SKVCdk.js";import"./circle-zvKHdShd.js";async function R(s,t,r){const a=y(f,"products");let o;return t?o=d(a,p("sellerId","==",s),u("createdAt","desc"),j(t),m(r)):o=d(a,p("sellerId","==",s),u("createdAt","desc"),m(r)),(await w(o)).docs.map(n=>v(n.data()))}async function U(s){await D(N(f,"products",s)).catch(t=>{throw t})}function _(){const s=P();return V({mutationFn:async({id:t,images:r})=>{await U(t);for(const a of r)F(a)},onMutate:async({id:t})=>{const r=["getProducts","sellerProducts"];await s.cancelQueries({queryKey:r});const a=s.getQueryData(r);let o=[];for(const i of a.pages)o=o.concat(i);s.setQueryData(r,o.filter(i=>i.id!==t))},onSuccess:()=>{console.log("success")},onError:t=>{console.log(t)}})}const z=({product:s})=>{const{data:t,isLoading:r,isError:a}=K({queryKey:["productImage",s.productImage[0]],queryFn:({queryKey:c})=>L(c[1]),staleTime:1/0}),o=M(),{mutate:i}=_(),n=()=>{o(`/mypage/edit-product?product=${s.id}`)},l=async()=>{window.confirm("상품을 삭제하시겠습니까?")&&i({id:s.id,images:s.productImage})};return e.jsxs("div",{className:"flex m-1 p-4 items-center border border-y-neutral-200 border-x-0",children:[e.jsx("div",{className:"w-24 h-24 min-w-24",children:a?e.jsx("div",{className:"w-full h-full bg-gray-100"}):r?e.jsx(h,{}):e.jsx("img",{src:t,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center w-full justify-end cursor-pointer mx-4",onClick:()=>o(`/product/${s.id}`),children:[e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-ellipsis	text-base line-clamp-1",children:s.productName}),e.jsx("div",{className:"text-sm text-gray-400 min-w-max",children:s.productCategory})]}),e.jsx("div",{className:"min-w-max",children:T(s.productPrice)}),e.jsx("div",{className:"w-20 flex justify-end",children:s.productQuantity})]}),e.jsx("div",{children:e.jsxs(E,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(k,{variant:"ghost",children:e.jsx(A,{})})}),e.jsxs(S,{className:"w-16",children:[e.jsx(x,{onClick:n,children:"수정"}),e.jsx(x,{onClick:l,children:"삭제"})]})]})})]})},ye=()=>{const s=q(),[t,r]=b(),{products:a,isLoading:o,isError:i,hasNextPage:n,fetchNextPage:l}=B({rowsPerPage:5,qKey:["sellerProducts"],queryFunc:(c,g)=>R(s.id,c,g),sortBy:"createdAt"});return C.useEffect(()=>{r&&n&&l()},[r,n,l]),e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsxs(I,{children:[e.jsx("h1",{className:"h1 mb-12",children:"전체 상품 조회"}),i?e.jsx("p",{children:"상품을 불러오지 못했습니다."}):e.jsxs("div",{children:[o&&e.jsx(h,{}),e.jsxs("ul",{children:[a&&a.map(c=>e.jsx("li",{children:e.jsx(z,{product:c})},`product_${c.id}`)),e.jsx("div",{ref:t})]})]})]})]})};export{ye as default};
