import{k as I,q as C,o as k,w as E,m as M,e as S,u as L,j as e,L as j,a as T,g as B,_ as O}from"./index-FIlqUQy7.js";import{B as P}from"./index-j0nxY3oc.js";import{M as F}from"./MyPageLayout-nhL4BXZX.js";import{f as R,a as A,o as K}from"./orderStatusToString-RMqDhgDU.js";import $ from"./getImageUrl-OqKMeRG-.js";import Q from"./getUser-4pCzCmxC.js";import{S as d}from"./order-zBTb25aT.js";import{D as U,a as V,b as W,c as w}from"./dropdown-menu-q94PI4Z2.js";import{M as z}from"./MetaTag-VgbHpOZK.js";import{u as m}from"./useQuery-cNdFQeOr.js";import"./iconBase-iSPQGmgu.js";import"./utils-e7QYg_mL.js";import"./index-JylqWpyc.js";import"./index-gxEFgUwi.js";import"./index-EOJ1QxCX.js";import"./Combination-3J9WhP_G.js";import"./check-MbevbEUm.js";import"./index-yRSaLw9b.js";import"./createLucideIcon-660fMRwt.js";import"./index-ErLbnoe3.js";import"./index-WMLiEZMb.js";import"./chevron-right-p5SKVCdk.js";import"./circle-zvKHdShd.js";import"./suspense-eH29BjpB.js";async function G(t){const a=I(S,"orders"),o=C(a,E("buyerId","==",t),k("createdAt","desc"));return(await M(o)).docs.map(i=>R(i.data()))}const H=({filename:t})=>{const{data:a,isLoading:o,isError:l,error:i}=m({queryKey:["productImage",t],queryFn:({queryKey:r})=>$(r[1]),staleTime:1/0});return o?e.jsx(j,{}):l?(console.log(i),e.jsx("div",{className:"w-full h-full bg-gray-100"})):e.jsx("img",{src:a,className:"w-full h-full object-cover"})},J=({orderId:t,date:a,productId:o,quantity:l,sellerId:i,status:r})=>{const u=T(),{data:h,isError:y,error:N}=m({queryKey:["userNickname",i],queryFn:async({queryKey:s})=>{const n=await Q(s[1]);return n?n.nickname:null}});y&&console.log(N);const{data:c,isLoading:g,isError:p,error:v}=m({queryKey:["product",o],queryFn:async({queryKey:s})=>{const n=await B(s[1]);if(n)return n}});p&&console.log(v);const _=()=>{},b=async()=>{if(window.confirm("정말 주문을 취소하시겠습니까?")){const{default:n}=await O(()=>import("./updateOrderStatus-dbCkV-Y-.js"),__vite__mapDeps([0,1,2]));await n(t,d.order_canceled).then(()=>{window.alert("주문을 취소하였습니다."),window.location.reload()}).catch(D=>{console.log(D),window.alert("주문를 취소하지 못했습니다.")})}};function x(s){return s!==d.deliver_completed&&s!==d.order_canceled}function f(s){return s==d.deliver_completed}const q=()=>{u(`/product/${c==null?void 0:c.id}`)};return e.jsxs("div",{className:"flex items-center p-4 ",children:[e.jsx("div",{className:"mr-4 w-32 flex justify-center ",children:e.jsx("p",{children:A(a.toDate())})}),e.jsx("div",{className:"w-24 h-24 min-w-24 mr-4",children:g?e.jsx(j,{}):p?e.jsx("div",{className:"w-full h-full bg-gray-100"}):e.jsx(H,{filename:c.productImage[0]})}),e.jsxs("div",{className:"w-full",children:[g?e.jsx("p",{}):p?e.jsx("p",{}):e.jsx("button",{className:"text-ellipsis line-clamp-1 text-sm",onClick:q,children:c.productName}),e.jsx("p",{className:"text-sm",children:`수량: ${l}`})]}),e.jsx("div",{children:h&&e.jsx("p",{className:"text-ellipsis line-clamp-1 text-sm",children:h})}),e.jsx("div",{className:"ml-4",children:e.jsx("p",{className:"text-sm min-w-max",children:K(r,!1)})}),e.jsx("div",{className:"ml-4 ",children:e.jsxs(U,{children:[e.jsx(V,{asChild:!0,children:e.jsx("button",{className:`button ${!(x(r)||f(r))&&"opacity-0"}`,disabled:!(x(r)||f(r)),children:e.jsx(P,{})})}),e.jsxs(W,{children:[f(r)&&e.jsx(w,{onClick:_,children:"리뷰 작성"}),x(r)&&e.jsx(w,{onClick:b,children:"주문 취소"})]})]})})]})},Ne=()=>{const t=L(),{data:a,isLoading:o,isError:l,error:i}=m({queryKey:["orders",t.id],queryFn:({queryKey:r})=>G(r[1])});return o?e.jsx(j,{}):l?(console.log(i),e.jsx("p",{children:"주문 내역을 불러오지 못했습니다."})):e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs(F,{children:[e.jsx("h1",{className:"h1 mb-12",children:"주문 내역"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm p-4 pr-12 flex border-b border-black",children:[e.jsx("p",{className:"w-32 text-center",children:"주문일"}),e.jsx("p",{className:"w-full text-center",children:"상품"}),e.jsx("p",{className:"text-center min-w-max mr-4",children:"판매자"}),e.jsx("p",{className:"w-20 text-center min-w-max",children:"주문 상태"})]}),e.jsx("ul",{className:"mt-4",children:a.map((r,u)=>e.jsx("li",{className:"*:mt-4",children:e.jsx(J,{orderId:r.id,date:r.createdAt,productId:r.productId,quantity:r.productQuantity,sellerId:r.sellerId,status:r.status})},`order_${u}`))})]})]})]})};export{Ne as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/updateOrderStatus-dbCkV-Y-.js","assets/index-FIlqUQy7.js","assets/index-GtDIvQPK.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
