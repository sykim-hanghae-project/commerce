import{k as y,c as f,q as d,l as m,s as g,o as u,w as p,m as w,n as N,Q as v,d as D,J as P,a as M,j as e,L as h,u as b,r as q}from"./index-Mj_532zd.js";import{u as C,a as I}from"./useProductsQuery-SxehyA_i.js";import{M as Q}from"./MyPageLayout-xo_PvLsc.js";import{B as k}from"./index-fISGOLI1.js";import{D as A,a as B,b as E,c as x}from"./dropdown-menu-Um4dmr_q.js";import S from"./getImageUrl-_4LojNWQ.js";import{p as L}from"./priceToString-jyYOkqXM.js";import T from"./deleteImage-Igawbdwy.js";import{u as F}from"./useMutation-17wli7ZR.js";import{u as V}from"./useQuery-xKBdAQzs.js";import{M as K}from"./MetaTag-CrOaKb5E.js";import"./suspense-MS5c6pCA.js";import"./utils-jGl1oAH7.js";import"./iconBase-CyTb4QjU.js";import"./utils-JMbXyAjn.js";import"./index-anneVPZw.js";import"./index-E40T28Bx.js";import"./index-lCxvLQy8.js";import"./Combination-cVxYeD5X.js";import"./check-OZnlZ5Lw.js";import"./index-BYHx_PqW.js";import"./createLucideIcon-gcZbVoT_.js";import"./index-YCP61iY6.js";import"./index-Vlq_45dw.js";import"./chevron-right-7pjBD6o2.js";import"./circle-6XXZfcpJ.js";async function $(s,t,r){const o=y(f,"products");let a;return t?a=d(o,p("sellerId","==",s),u("createdAt","desc"),g(t),m(r)):a=d(o,p("sellerId","==",s),u("createdAt","desc"),m(r)),(await w(a)).docs.map(n=>N(n.data()))}async function R(s){await v(D(f,"products",s)).catch(t=>{throw t})}function z(){const s=P();return F({mutationFn:async({id:t,images:r})=>{await R(t);for(const o of r)T(o)},onMutate:async({id:t})=>{const r=["getProducts","sellerProducts"];await s.cancelQueries({queryKey:r});const o=s.getQueryData(r);let a=[];for(const i of o.pages)a=a.concat(i);s.setQueryData(r,a.filter(i=>i.id!==t))},onSuccess:()=>{console.log("success")},onError:t=>{console.log(t)}})}const J=({product:s})=>{const{data:t,isLoading:r,isError:o}=V({queryKey:["productImage",s.productImage[0]],queryFn:({queryKey:c})=>S(c[1]),staleTime:1/0}),a=M(),{mutate:i}=z(),n=()=>{a(`/mypage/edit-product?product=${s.id}`)},l=async()=>{window.confirm("상품을 삭제하시겠습니까?")&&i({id:s.id,images:s.productImage})};return e.jsxs("div",{className:"flex m-1 p-4 items-center",children:[e.jsx("div",{className:"w-24 h-24 min-w-24",children:r?e.jsx(h,{}):o?e.jsx("div",{className:"w-full h-full bg-gray-100"}):e.jsx("img",{src:t,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex items-center w-full justify-end cursor-pointer mx-4",onClick:()=>a(`/product/${s.id}`),children:[e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-ellipsis	text-base line-clamp-1",children:s.productName}),e.jsx("div",{className:"text-sm text-gray-400 min-w-max",children:s.productCategory})]}),e.jsx("div",{className:"w-24",children:L(s.productPrice)}),e.jsx("div",{className:"w-20 ml-4 flex justify-center",children:s.productQuantity})]}),e.jsx("div",{className:"flex items-center justify-end w-8",children:e.jsxs(A,{children:[e.jsx(B,{asChild:!0,children:e.jsx("button",{children:e.jsx(k,{})})}),e.jsxs(E,{className:"w-16",children:[e.jsx(x,{onClick:n,children:"수정"}),e.jsx(x,{onClick:l,children:"삭제"})]})]})})]})},je=()=>{const s=b(),[t,r]=C(),{products:o,isLoading:a,isError:i,hasNextPage:n,fetchNextPage:l}=I({rowsPerPage:5,qKey:["sellerProducts"],queryFunc:(c,j)=>$(s.id,c,j),sortBy:"createdAt"});return q.useEffect(()=>{r&&n&&l()},[r,n,l]),e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs(Q,{children:[e.jsx("h1",{className:"h1 mb-12",children:"전체 상품 조회"}),a?e.jsx(h,{}):i?e.jsx("p",{children:"상품을 불러오지 못했습니다."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex text-sm p-4 border-b border-black",children:[e.jsx("p",{className:"w-full text-center",children:"상품"}),e.jsx("p",{className:"w-24 text-center ml-4",children:"가격"}),e.jsx("p",{className:"min-w-max w-20 mr-12 ml-4",children:"잔여 수량"})]}),e.jsxs("ul",{children:[o&&o.map(c=>e.jsx("li",{children:e.jsx(J,{product:c})},`product_${c.id}`)),e.jsx("div",{ref:t})]})]})]})]})};export{je as default};
