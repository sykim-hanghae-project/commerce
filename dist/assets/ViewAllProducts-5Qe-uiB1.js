import{m as g,e as f,q as d,l as m,s as N,o as u,w as x,n as D,p as v,Q as P,d as M,c as b,u as j,a as C,j as e,r as q,L as p}from"./index-Vq1JXboX.js";import{u as A,a as B}from"./useProductsQuery-fC5KW7wc.js";import{M as Q}from"./MyPageLayout-MjCD9FnJ.js";import{B as S}from"./index-WvyGGEiZ.js";import{D as k,a as E,b as T,c as h}from"./dropdown-menu-7cEWt2g_.js";import{p as I}from"./priceToString-jyYOkqXM.js";import L from"./deleteProductImage-lQ2FOteI.js";import{u as F}from"./useMutation-3Ms68lDS.js";import{M as V}from"./MetaTag-ZlBfLCmT.js";import"./useBaseQuery-zMsKL3zC.js";import"./utils-bemYdGE3.js";import"./suspense-9ho99RMx.js";import"./iconBase-djffxSNR.js";import"./utils-Anq8py01.js";import"./index-mOhbM-ib.js";import"./index-wocOw3ZL.js";import"./index-9gxzcVvN.js";import"./Combination-p9BSy9O-.js";import"./index-UVn-uUOv.js";import"./index-wOepbJQq.js";import"./index-iK2Kvbv4.js";import"./index-nQqo4rGF.js";async function $(s,t,r){const i=g(f,"products");let a;return t?a=d(i,x("sellerId","==",s),u("createdAt","desc"),N(t),m(r)):a=d(i,x("sellerId","==",s),u("createdAt","desc"),m(r)),(await D(a)).docs.map(c=>v(c.data()))}async function K(s){await P(M(f,"products",s)).catch(t=>{throw t})}function R(){const s=b();return F({mutationFn:async({productId:t,userId:r})=>{await L(r,t),await K(t)},onMutate:async({productId:t})=>{const r=["getProducts","sellerProducts"];await s.cancelQueries({queryKey:r});const i=s.getQueryData(r);let a=[];for(const o of i.pages)a=a.concat(o);s.setQueryData(r,a.filter(o=>o.id!==t))},onSuccess:async()=>{console.log("success")},onError:t=>{console.log(t)}})}const z=({product:s})=>{const t=j(),r=C(),{mutate:i}=R(),a=()=>{r(`/mypage/edit-product?product=${s.id}`)},o=async()=>{window.confirm("상품을 삭제하시겠습니까?")&&i({productId:s.id,userId:t.id})};return e.jsxs("div",{className:"flex m-1 p-4 items-center",children:[e.jsx("div",{className:"w-24 h-24 min-w-24",children:e.jsx("img",{src:s.productThumbnail[0],className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex items-center w-full justify-end cursor-pointer mx-4",onClick:()=>r(`/product/${s.id}`),children:[e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-ellipsis	text-base line-clamp-1",children:s.productName}),e.jsx("div",{className:"text-sm text-gray-400 min-w-max",children:s.productCategory})]}),e.jsx("div",{className:"w-24 min-w-max",children:I(s.productPrice)}),e.jsx("div",{className:"w-20 ml-4 flex justify-center",children:s.productQuantity})]}),e.jsx("div",{className:"flex items-center justify-end w-8",children:e.jsxs(k,{children:[e.jsx(E,{asChild:!0,children:e.jsx("button",{children:e.jsx(S,{})})}),e.jsxs(T,{className:"w-16",children:[e.jsx(h,{onClick:a,children:"수정"}),e.jsx(h,{onClick:o,children:"삭제"})]})]})})]})},ue=()=>{const s=j(),[t,r]=A(),{products:i,isLoading:a,isError:o,hasNextPage:c,fetchNextPage:l,isFetchingNextPage:w}=B({rowsPerPage:10,qKey:["sellerProducts"],queryFunc:(n,y)=>$(s.id,n,y),sortBy:"createdAt"});return q.useEffect(()=>{r&&c&&l()},[r,c,l]),e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs(Q,{children:[e.jsx("h1",{className:"h1 mb-12",children:"전체 상품 조회"}),a?e.jsx(p,{}):o?e.jsx("p",{children:"상품을 불러오지 못했습니다."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex text-sm p-4 border-b border-black",children:[e.jsx("p",{className:"w-full text-center",children:"상품"}),e.jsx("p",{className:"w-24 text-center ml-4",children:"가격"}),e.jsx("p",{className:"min-w-max w-20 mr-12 ml-4",children:"잔여 수량"})]}),e.jsx("ul",{children:i&&i.map(n=>e.jsx("li",{children:e.jsx(z,{product:n})},`product_${n.id}`))}),w?e.jsx(p,{}):e.jsx("div",{ref:t})]})]})]})};export{ue as default};
