import{l as P,m as j,n as I,p as N,r as m,a as S,h as E,b as q,j as i,L as p}from"./index-SUEa9kdL.js";import{M as L}from"./MyPageLayout-2RRNtoFX.js";import{P as Q,u as f}from"./ProductForm-tUin4QMD.js";import{d as B}from"./deleteImage-KlfcSXJv.js";import{u as C}from"./updateProduct-HBDXZvn6.js";import"./select-L7kq68E_.js";import"./index-IZI7hSOV.js";import"./check-Cf6Jmweb.js";import"./index-ny_t__IU.js";import"./createLucideIcon-qPvvMrlJ.js";import"./index-7l5MHl0U.js";import"./input-D_3ZA80K.js";async function D(s){const c=P(I,`images/${s}`);return await j(c)}const H=()=>{const[s]=N(),[c,u]=m.useState(!1),[d,l]=m.useState(),{data:o,isLoading:g,isError:y,error:b}=S({queryKey:["prevProduct",s.get("product")],queryFn:({queryKey:t})=>E(t[1]),staleTime:1/0}),h=q();if(m.useEffect(()=>{o&&l(o)},[o]),g)return i.jsx(p,{});y&&(console.log(b),window.location.replace("/mypage"));async function w(t){console.log(t),u(!0);try{const a=[];if(t.image){for(const e of t.image)if(e.isOriginal){const r=await D(e.filename);a.push(r)}}for(const e of d.productImage)await B(e);const n=[];for(const e of a){const r=await f(e);n.push(r)}if(t.image){for(const e of t.image)if(!e.isOriginal){const r=await f(e.file);n.push(r)}}const x={productName:t.name,productDescription:t.description,productImage:n,productCategory:t.category,productPrice:t.price,productQuantity:t.quantity};await C(d.id,x),window.alert("상품을 성공적으로 수정하였습니다.")}catch(a){console.log(a),window.alert("상품 수정에 실패하였습니다.")}finally{h("/mypage")}}return i.jsxs(L,{children:[i.jsx("h1",{className:"h1 mb-6",children:"상품 등록"}),i.jsx("p",{className:"mb-6",children:"상품의 정보를 입력해주세요."}),i.jsx("div",{className:"w-full",children:i.jsx(Q,{onSubmit:w,defaultValues:o?{name:o.productName,description:o.productDescription,image:o.productImage,category:o.productCategory,price:o.productPrice,quantity:o.productQuantity}:void 0})}),c&&i.jsx("div",{className:"fixed top-0 left-0 w-[100vw] h-[100vh] flex justify-center items-center",children:i.jsx(p,{})})]})};export{H as default};
