import{c as I,q as C,o as M,w as S,g as _,d as k,u as B,a as m,j as e,L as f,b as E,B as L,e as T,f as O,h as F}from"./index-DyzY6ZJS.js";import{M as P}from"./MyPageLayout-GYR7_71g.js";import{f as K,a as R,o as $,u as A}from"./orderStatusToString-67PJrJc5.js";import{S as d}from"./order-zBTb25aT.js";import{D as Q,a as U,b as W,c as g}from"./dropdown-menu-fT84Io2k.js";import{M as V}from"./MetaTag-qCC6KGd0.js";import"./index-N5PwOM_v.js";import"./check-jMnHZxu6.js";import"./index-vVzCxcJx.js";import"./createLucideIcon-SSY--W-o.js";import"./index-5eAsy_8A.js";import"./chevron-right-8nadc7Ui.js";import"./circle-fyDEMZHM.js";async function z(a){const t=I(k,"orders"),n=C(t,S("buyerId","==",a),M("createdAt","desc"));return(await _(n)).docs.map(i=>K(i.data()))}const G=({filename:a})=>{const{data:t,isLoading:n,isError:c,error:i}=m({queryKey:["productImage",a],queryFn:({queryKey:r})=>T(r[1]),staleTime:1/0});return n?e.jsx(f,{}):c?(console.log(i),e.jsx("div",{className:"w-full h-full bg-gray-100"})):e.jsx("img",{src:t,className:"w-full h-full object-cover"})},H=({orderId:a,date:t,productId:n,quantity:c,sellerId:i,status:r})=>{const u=E(),{data:h,isError:w,error:N}=m({queryKey:["userNickname",i],queryFn:async({queryKey:s})=>{const o=await O(s[1]);return o?o.nickname:null}});w&&console.log(N);const{data:l,isLoading:y,isError:x,error:v}=m({queryKey:["product",n],queryFn:async({queryKey:s})=>{const o=await F(s[1]);if(o)return o}});x&&console.log(v);const b=()=>{},q=async()=>{window.confirm("정말 주문을 취소하시겠습니까?")&&(await A(a,d.order_canceled),window.alert("주문을 취소하였습니다."),window.location.reload())};function p(s){return s!==d.deliver_completed&&s!==d.order_canceled}function j(s){return s==d.deliver_completed}const D=()=>{u(`/product/${l==null?void 0:l.id}`)};return e.jsxs("div",{className:"flex items-center p-4 ",children:[e.jsx("div",{className:"mr-4 w-32 flex justify-center ",children:e.jsx("p",{children:R(t.toDate())})}),e.jsx("div",{className:"w-24 h-24 min-w-24 mr-4",children:y?e.jsx(f,{}):x?e.jsx("div",{className:"w-full h-full bg-gray-100"}):e.jsx(G,{filename:l.productImage[0]})}),e.jsxs("div",{className:"w-full",children:[y?e.jsx("p",{}):x?e.jsx("p",{}):e.jsx("button",{className:"text-ellipsis line-clamp-1 text-sm",onClick:D,children:l.productName}),e.jsx("p",{className:"text-sm",children:`수량: ${c}`})]}),e.jsx("div",{children:h&&e.jsx("p",{className:"text-ellipsis line-clamp-1 text-sm",children:h})}),e.jsx("div",{className:"ml-4",children:e.jsx("p",{className:"text-sm min-w-max",children:$(r,!1)})}),e.jsx("div",{className:"ml-4 ",children:e.jsxs(Q,{children:[e.jsx(U,{asChild:!0,children:e.jsx("button",{className:`button ${!(p(r)||j(r))&&"opacity-0"}`,disabled:!(p(r)||j(r)),children:e.jsx(L,{})})}),e.jsxs(W,{children:[j(r)&&e.jsx(g,{onClick:b,children:"리뷰 작성"}),p(r)&&e.jsx(g,{onClick:q,children:"주문 취소"})]})]})})]})},oe=()=>{const a=B(),{data:t,isLoading:n,isError:c,error:i}=m({queryKey:["orders",a.id],queryFn:({queryKey:r})=>z(r[1])});return n?e.jsx(f,{}):c?(console.log(i),e.jsx("p",{children:"주문 내역을 불러오지 못했습니다."})):e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs(P,{children:[e.jsx("h1",{className:"h1 mb-12",children:"주문 내역"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm p-4 pr-12 flex border-b border-black",children:[e.jsx("p",{className:"w-32 text-center",children:"주문일"}),e.jsx("p",{className:"w-full text-center",children:"상품"}),e.jsx("p",{className:"text-center min-w-max mr-4",children:"판매자"}),e.jsx("p",{className:"w-20 text-center min-w-max",children:"주문 상태"})]}),e.jsx("ul",{className:"mt-4",children:t.map((r,u)=>e.jsx("li",{className:"*:mt-4",children:e.jsx(H,{orderId:r.id,date:r.createdAt,productId:r.productId,quantity:r.productQuantity,sellerId:r.sellerId,status:r.status})},`order_${u}`))})]})]})]})};export{oe as default};
