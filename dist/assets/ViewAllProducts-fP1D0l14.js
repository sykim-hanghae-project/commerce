import{c as w,d as h,q as m,F as x,H as D,o as f,w as p,g as v,I as N,a as P,e as q,b as C,j as e,L as g,J as I,E as M,B as b,K as B,k as E,M as A,u as Q,r as S}from"./index-SUEa9kdL.js";import{u as k,a as L}from"./useProductsQuery-t57tE96E.js";import{M as T}from"./MyPageLayout-2RRNtoFX.js";import{D as F,a as K,b as V,c as y}from"./dropdown-menu-u3iLsk5s.js";import{d as $}from"./deleteImage-KlfcSXJv.js";import{u as R}from"./useMutation-p_CFnHhc.js";import"./index-IZI7hSOV.js";import"./check-Cf6Jmweb.js";import"./index-ny_t__IU.js";import"./createLucideIcon-qPvvMrlJ.js";import"./index-Rb4N21dl.js";import"./chevron-right-ZQy03gf7.js";import"./circle-Tgc7RxQ0.js";async function H(s,t,r){const o=w(h,"products");let a;return t?a=m(o,p("sellerId","==",s),f("createdAt","desc"),D(t),x(r)):a=m(o,p("sellerId","==",s),f("createdAt","desc"),x(r)),(await v(a)).docs.map(n=>N(n.data()))}const J=({product:s,onDeleteProduct:t})=>{const{data:r,isLoading:o,isError:a}=P({queryKey:["productImage",s.productImage[0]],queryFn:({queryKey:l})=>q(l[1]),staleTime:1/0}),c=C(),n=()=>{c(`/mypage/edit-product?product=${s.id}`)},d=async()=>{window.confirm("상품을 삭제하시겠습니까?")&&t(s.id,s.productImage)};return e.jsxs("div",{className:"flex m-1 p-4 items-center border border-y-neutral-200 border-x-0",children:[e.jsx("div",{className:"w-24 h-24 min-w-24",children:a?e.jsx("div",{className:"w-full h-full bg-gray-100"}):o?e.jsx(g,{}):e.jsx("img",{src:r,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center w-full justify-end cursor-pointer mx-4",onClick:()=>c(`/product/${s.id}`),children:[e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-ellipsis	text-base line-clamp-1",children:s.productName}),e.jsx("div",{className:"text-sm text-gray-400 min-w-max",children:s.productCategory})]}),e.jsx("div",{className:"min-w-max",children:I(s.productPrice)}),e.jsx("div",{className:"w-20 flex justify-end",children:s.productQuantity})]}),e.jsx("div",{children:e.jsxs(F,{children:[e.jsx(K,{asChild:!0,children:e.jsx(M,{variant:"ghost",children:e.jsx(b,{})})}),e.jsxs(V,{className:"w-16",children:[e.jsx(y,{onClick:n,children:"수정"}),e.jsx(y,{onClick:d,children:"삭제"})]})]})})]})};async function U(s){await B(E(h,"products",s)).catch(t=>{throw t})}function _(){const s=A();return R({mutationFn:async({id:t,images:r})=>{await U(t);for(const o of r)$(o)},onMutate:async({id:t})=>{const r=["getProducts","sellerProducts"];await s.cancelQueries({queryKey:r});const o=s.getQueryData(r);let a=[];for(const c of o.pages)a=a.concat(c);s.setQueryData(r,a.filter(c=>c.id!==t))},onSuccess:()=>{console.log("success")},onError:t=>{console.log(t)}})}const ce=()=>{const s=Q(),{mutate:t}=_(),[r,o]=k(),{products:a,isLoading:c,isError:n,hasNextPage:d,fetchNextPage:l}=L({rowsPerPage:5,qKey:"sellerProducts",queryFunc:(i,u)=>H(s.id,i,u),sortBy:"createdAt"}),j=(i,u)=>{t({id:i,images:u})};return S.useEffect(()=>{o&&d&&l()},[o,d,l]),e.jsxs(T,{children:[e.jsx("h1",{className:"h1 mb-12",children:"전체 상품 조회"}),n?e.jsx("p",{children:"상품을 불러오지 못했습니다."}):e.jsxs("div",{children:[c&&e.jsx(g,{}),e.jsxs("ul",{children:[a&&a.map(i=>e.jsx("li",{children:e.jsx(J,{product:i,onDeleteProduct:j})},`product_${i.id}`)),e.jsx("div",{ref:r})]})]})]})};export{ce as default};
